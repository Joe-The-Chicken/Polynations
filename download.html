<!DOCTYPE html>
<html>
    <body>
        <input type="file" id="up" accept=".jpg,.jpeg,.png">
<script>
function downloadString(text, fileType, fileName) {
    var blob = new Blob([text], { type: fileType });

    var a = document.createElement('a');
    a.download = fileName;
    a.href = URL.createObjectURL(blob);
    a.dataset.downloadurl = [fileType, a.download, a.href].join(':');
    a.style.display = "none";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(function() { URL.revokeObjectURL(a.href); }, 1500);
}
up.onchange = async e => {
  const img = new Image();
  img.src = URL.createObjectURL(e.target.files[0]);
  await img.decode();

  const cvs = Object.assign(document.createElement('canvas'),
                            {width: img.width, height: img.height});
  const ctx = cvs.getContext('2d');
  ctx.drawImage(img, 0, 0);

  const {data, width, height} = ctx.getImageData(0, 0, img.width, img.height);
  const bits = [];
  for (let y = 0; y < height; ++y) {
    for (let x = 0; x < width; ++x) {
      const i = (y * width + x) * 4;        // RGBA stride
      const lum = 0.299*data[i] + 0.587*data[i+1] + 0.114*data[i+2];
      bits.push(lum < 128 ? 0 : -1);
    }
  }

  downloadString(JSON.stringify(bits),"text","pixels.txt")
};
</script>
    </body>
</html>